#!/bin/bash\n\n# Test script for subscriber-facing Next.js app\n# Tests all pages, API routes, and PWA functionality\n\necho \"üß™ Testing Subscriber-Facing Next.js App\"\necho \"========================================\"\n\n# Colors for output\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nNC='\\033[0m' # No Color\n\n# Test results\nPASSED=0\nFAILED=0\n\n# Function to test HTTP endpoint\ntest_endpoint() {\n    local url=$1\n    local expected_status=${2:-200}\n    local description=$3\n    \n    echo -n \"Testing $description... \"\n    \n    if command -v curl >/dev/null 2>&1; then\n        response=$(curl -s -o /dev/null -w \"%{http_code}\" \"$url\" 2>/dev/null)\n        if [ \"$response\" = \"$expected_status\" ]; then\n            echo -e \"${GREEN}‚úÖ PASS${NC} ($response)\"\n            ((PASSED++))\n        else\n            echo -e \"${RED}‚ùå FAIL${NC} (got $response, expected $expected_status)\"\n            ((FAILED++))\n        fi\n    else\n        echo -e \"${YELLOW}‚ö†Ô∏è  SKIP${NC} (curl not available)\"\n    fi\n}\n\n# Function to test file exists\ntest_file() {\n    local file=$1\n    local description=$2\n    \n    echo -n \"Testing $description... \"\n    \n    if [ -f \"$file\" ]; then\n        echo -e \"${GREEN}‚úÖ PASS${NC}\"\n        ((PASSED++))\n    else\n        echo -e \"${RED}‚ùå FAIL${NC} (file not found: $file)\"\n        ((FAILED++))\n    fi\n}\n\n# Function to test file contains content\ntest_file_content() {\n    local file=$1\n    local pattern=$2\n    local description=$3\n    \n    echo -n \"Testing $description... \"\n    \n    if [ -f \"$file\" ] && grep -q \"$pattern\" \"$file\"; then\n        echo -e \"${GREEN}‚úÖ PASS${NC}\"\n        ((PASSED++))\n    else\n        echo -e \"${RED}‚ùå FAIL${NC} (pattern '$pattern' not found in $file)\"\n        ((FAILED++))\n    fi\n}\n\n# Start testing\necho \"üìÅ Testing File Structure\"\necho \"------------------------\"\n\n# Test Next.js app structure\ntest_file \"app/layout.jsx\" \"Root layout component\"\ntest_file \"app/page.jsx\" \"Homepage component\"\ntest_file \"app/moments/page.jsx\" \"Moments page component\"\ntest_file \"app/broadcasts/page.jsx\" \"Broadcasts page component\"\ntest_file \"app/settings/page.jsx\" \"Settings page component\"\n\n# Test API routes\ntest_file \"app/api/moments/route.js\" \"Moments API route\"\ntest_file \"app/api/broadcasts/route.js\" \"Broadcasts API route\"\ntest_file \"app/api/analytics/route.js\" \"Analytics API route\"\n\n# Test PWA files\ntest_file \"public/manifest.json\" \"PWA manifest\"\ntest_file \"public/sw.js\" \"Service worker\"\ntest_file \"next.config.js\" \"Next.js configuration\"\n\necho \"\"\necho \"üìù Testing File Content\"\necho \"----------------------\"\n\n# Test component content\ntest_file_content \"app/layout.jsx\" \"'use client'\" \"Layout uses client components\"\ntest_file_content \"app/page.jsx\" \"useState\" \"Homepage has interactive state\"\ntest_file_content \"app/moments/page.jsx\" \"useEffect\" \"Moments page fetches data\"\ntest_file_content \"app/broadcasts/page.jsx\" \"calculateSuccessRate\" \"Broadcasts page has analytics\"\ntest_file_content \"app/settings/page.jsx\" \"localStorage\" \"Settings page persists preferences\"\n\n# Test API proxy functionality\ntest_file_content \"app/api/moments/route.js\" \"admin/moments\" \"Moments API proxies to backend\"\ntest_file_content \"app/api/broadcasts/route.js\" \"admin/broadcasts\" \"Broadcasts API proxies to backend\"\ntest_file_content \"app/api/analytics/route.js\" \"admin/analytics\" \"Analytics API proxies to backend\"\n\n# Test PWA configuration\ntest_file_content \"public/manifest.json\" \"standalone\" \"Manifest configured for PWA\"\ntest_file_content \"public/sw.js\" \"unami-moments\" \"Service worker has proper cache names\"\ntest_file_content \"next.config.js\" \"standalone\" \"Next.js configured for deployment\"\n\necho \"\"\necho \"üîß Testing Package Configuration\"\necho \"--------------------------------\"\n\n# Test package.json scripts\nif [ -f \"package.json\" ]; then\n    test_file_content \"package.json\" \"dev:next\" \"Next.js dev script exists\"\n    test_file_content \"package.json\" \"next\" \"Next.js dependency exists\"\nfi\n\necho \"\"\necho \"üåê Testing Local Server (if running)\"\necho \"------------------------------------\"\n\n# Test if server is running and endpoints respond\nBASE_URL=\"http://localhost:3000\"\n\n# Test Next.js pages (if server is running)\ntest_endpoint \"$BASE_URL\" 200 \"Homepage\"\ntest_endpoint \"$BASE_URL/moments\" 200 \"Moments page\"\ntest_endpoint \"$BASE_URL/broadcasts\" 200 \"Broadcasts page\"\ntest_endpoint \"$BASE_URL/settings\" 200 \"Settings page\"\n\n# Test API routes\ntest_endpoint \"$BASE_URL/api/moments\" 200 \"Moments API\"\ntest_endpoint \"$BASE_URL/api/broadcasts\" 200 \"Broadcasts API\"\ntest_endpoint \"$BASE_URL/api/analytics\" 200 \"Analytics API\"\n\n# Test PWA files\ntest_endpoint \"$BASE_URL/manifest.json\" 200 \"PWA Manifest\"\ntest_endpoint \"$BASE_URL/sw.js\" 200 \"Service Worker\"\n\necho \"\"\necho \"üì± Testing PWA Features\"\necho \"----------------------\"\n\n# Test manifest structure\nif [ -f \"public/manifest.json\" ]; then\n    test_file_content \"public/manifest.json\" \"Unami Moments\" \"App name in manifest\"\n    test_file_content \"public/manifest.json\" \"shortcuts\" \"App shortcuts defined\"\n    test_file_content \"public/manifest.json\" \"icons\" \"App icons defined\"\nfi\n\n# Test service worker features\nif [ -f \"public/sw.js\" ]; then\n    test_file_content \"public/sw.js\" \"API_CACHE_NAME\" \"Service worker caches API responses\"\n    test_file_content \"public/sw.js\" \"push\" \"Service worker supports push notifications\"\n    test_file_content \"public/sw.js\" \"offline\" \"Service worker handles offline scenarios\"\nfi\n\necho \"\"\necho \"üé® Testing UI Components\"\necho \"-----------------------\"\n\n# Test responsive design elements\ntest_file_content \"app/layout.jsx\" \"@media\" \"Responsive CSS included\"\ntest_file_content \"app/layout.jsx\" \"nav-mobile\" \"Mobile navigation implemented\"\n\n# Test interactive features\ntest_file_content \"app/moments/page.jsx\" \"filters\" \"Moments page has filtering\"\ntest_file_content \"app/broadcasts/page.jsx\" \"progress\" \"Broadcasts page shows progress\"\ntest_file_content \"app/settings/page.jsx\" \"preferences\" \"Settings page manages preferences\"\n\necho \"\"\necho \"üîó Testing Integration Points\"\necho \"-----------------------------\"\n\n# Test API integration\ntest_file_content \"app/page.jsx\" \"/api/analytics\" \"Homepage fetches analytics\"\ntest_file_content \"app/moments/page.jsx\" \"/api/moments\" \"Moments page fetches data\"\ntest_file_content \"app/broadcasts/page.jsx\" \"/api/broadcasts\" \"Broadcasts page fetches data\"\n\n# Test WhatsApp integration info\ntest_file_content \"app/page.jsx\" \"+27 65 829 5041\" \"WhatsApp number displayed\"\ntest_file_content \"app/settings/page.jsx\" \"START\" \"WhatsApp commands documented\"\n\necho \"\"\necho \"üìä Test Results Summary\"\necho \"======================\"\necho -e \"${GREEN}‚úÖ Passed: $PASSED${NC}\"\necho -e \"${RED}‚ùå Failed: $FAILED${NC}\"\necho -e \"Total Tests: $((PASSED + FAILED))\"\n\nif [ $FAILED -eq 0 ]; then\n    echo -e \"\\n${GREEN}üéâ All tests passed! Subscriber-facing app is ready.${NC}\"\n    exit 0\nelse\n    echo -e \"\\n${RED}‚ö†Ô∏è  Some tests failed. Please review the issues above.${NC}\"\n    exit 1\nfi\n
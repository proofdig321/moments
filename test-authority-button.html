<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Authority Button</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .btn { background: #2563eb; color: white; border: none; padding: 0.75rem 1rem; border-radius: 0.375rem; cursor: pointer; }
        .btn:hover { background: #1d4ed8; }
        .section { display: none; padding: 20px; border: 2px solid #ccc; margin-top: 20px; }
        .section.active { display: block; }
        .log { background: #f0f0f0; padding: 10px; margin-top: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Authority Button Test</h1>
    
    <div id="authority" class="section active">
        <h2>Authority Section</h2>
        <button class="btn" data-action="create-authority">➕ Assign Authority</button>
        <div id="log1" class="log">Waiting for button click...</div>
    </div>
    
    <div id="authority-form-section" class="section">
        <h2>Authority Form Section</h2>
        <p>✅ Form section is now visible!</p>
        <button class="btn" data-action="close-authority-form">← Back</button>
        <div id="log2" class="log">Form section loaded</div>
    </div>
    
    <script>
        const log1 = document.getElementById('log1');
        const log2 = document.getElementById('log2');
        
        function addLog(msg) {
            const timestamp = new Date().toLocaleTimeString();
            log1.innerHTML += `<br>[${timestamp}] ${msg}`;
            log2.innerHTML += `<br>[${timestamp}] ${msg}`;
            console.log(msg);
        }
        
        function showSection(sectionId) {
            addLog(`showSection called with: ${sectionId}`);
            document.querySelectorAll('.section').forEach(s => {
                s.classList.remove('active');
                addLog(`Removed active from: ${s.id}`);
            });
            const target = document.getElementById(sectionId);
            if (target) {
                target.classList.add('active');
                addLog(`Added active to: ${sectionId}`);
            } else {
                addLog(`ERROR: Section ${sectionId} not found!`);
            }
        }
        
        function handleAction(action, btn, event) {
            addLog(`handleAction called with action: ${action}`);
            switch (action) {
                case 'create-authority':
                    addLog('Case: create-authority matched');
                    showSection('authority-form-section');
                    break;
                case 'close-authority-form':
                    addLog('Case: close-authority-form matched');
                    showSection('authority');
                    break;
                default:
                    addLog(`Unhandled action: ${action}`);
            }
        }
        
        // Test 1: Direct button click listener
        document.querySelectorAll('[data-action="create-authority"]').forEach(btn => {
            addLog(`Found button with data-action: ${btn.dataset.action}`);
            btn.addEventListener('click', (e) => {
                addLog('Direct listener fired!');
            });
        });
        
        // Test 2: Event delegation with capture phase
        document.addEventListener('click', (e) => {
            addLog('Document click captured');
            const btn = e.target.closest('button');
            if (!btn) {
                addLog('Not a button click');
                return;
            }
            
            addLog(`Button clicked: ${btn.textContent.trim()}`);
            addLog(`Button dataset.action: ${btn.dataset.action}`);
            
            const action = btn.dataset.action;
            if (action) {
                e.preventDefault();
                e.stopPropagation();
                addLog(`Action found: ${action}, calling handleAction`);
                handleAction(action, btn, e);
            } else {
                addLog('No data-action attribute found');
            }
        }, true); // Capture phase
        
        addLog('Event listeners registered');
    </script>
</body>
</html>
